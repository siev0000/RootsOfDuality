<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç´„Éº„Éâ„Ç≤„Éº„É† - „É°„Ç§„É≥„É°„Éã„É•„Éº</title>
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/model.css">
    <link rel="stylesheet" href="styles/deck.css">
    <link rel="stylesheet" href="styles/battle.css">
    <script src="js/universalModal.js"></script>
</head>
<body>
    <div class="wrapper">
        <div class="footer-menu">
            <button class="tab-button" onclick="showTab('home')">üìú„Éõ„Éº„É†</button>
            <button class="tab-button" onclick="showTab('editDeck')">üÉè„Ç´„Éº„Éâ</button>
            <button class="tab-button" onclick="showTab('battle')">‚öîÔ∏è„Éê„Éà„É´</button>
            <button class="tab-button" onclick="showTab('openSettings')">‚öôË®≠ÂÆö</button>
            <button class="tab-button" onclick="showTab('effects')">üìä</button>
            <button class="tab-button save-button" onclick="exportUserDataToFile()">üíæ„Çª„Éº„Éñ</button>
            <!-- <button onclick="openModal()">üìä</button> -->
        </div>
        <div class="content">
            <div id="home" class="tab-content">
                <div id="notification-controls" class="tab-controls">
                    <!-- ÂãïÁöÑ„Å´„Çø„Éñ„ÅåÁîüÊàê„Åï„Çå„Åæ„Åô -->
                </div>
                <div id="notification-content" class="notification-tab-content">
                    <!-- ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÅÆÂÜÖÂÆπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                </div>
            </div>
            <div id="editDeck" class="tab-content">
                <div id="deck-container" class="deck-container">
                    <!-- „Éá„ÉÉ„Ç≠‰∏ÄË¶ß„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                </div>
            </div>
            <div id="battle" class="tab-content">
                <div id="battle-container" class="battle-container">
                    <!-- „Éá„ÉÉ„Ç≠‰∏ÄË¶ß„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                </div>
            </div>
            <div id="openSettings" class="tab-content">
                <div id="settingsVolumeContainer">
                    <form id="volumeSettingsForm">
                        <label for="masterVolume">„Éû„Çπ„Çø„Éº„Éú„É™„É•„Éº„É†</label>
                        <input type="range" id="masterVolume" name="masterVolume" min="0" max="100" value="50">
                        
                        <label for="bgmVolume">BGMÈü≥Èáè</label>
                        <input type="range" id="bgmVolume" name="bgmVolume" min="0" max="100" value="50">
                        
                        <label for="sfxVolume">ÂäπÊûúÈü≥(SFX)Èü≥Èáè</label>
                        <input type="range" id="sfxVolume" name="sfxVolume" min="0" max="100" value="50">
                        
                        <button id="soundSave" type="submit" onclick="saveVolumeSettings()">‰øùÂ≠ò</button>
                    </form>
                </div>
            </div>

            <div id="effects" class="tab-content" style="width: 100%; height: 100%;">
              <iframe id="effect-iframe" src="animePng.html" style="width: 100%; height: 100%; border: none;"></iframe>
            </div>

        </div>
            <!-- <button class="menu-button" onclick="logout()">üö™</button> -->
    </div>

    <!-- Ê±éÁî® „É¢„Éº„ÉÄ„É´ -->
    <div id="universal-modal" class="u-modal">
        <div class="u-modal__content">
            <div class="u-modal__header">
            <span id="modal-icon" class="u-modal__icon">ü™Ñ</span>
            <h2 id="modal-title" class="u-modal__title">„Çø„Ç§„Éà„É´</h2>
            <span class="u-modal__close" onclick="closeUniversalModal()">&times;</span>
            </div>
            <div id="modal-body" class="u-modal__body">
            <p>„É°„ÉÉ„Çª„Éº„Ç∏</p>
            <div class="u-modal__table-container">
                <table class="u-modal__table">
                <thead>
                </thead>
                <tbody>
                </tbody>
                </table>
            </div>
            </div>
            <div id="modal-footer" class="u-modal__footer">
            <button class="u-modal__button" onclick="closeUniversalModal()">Èñâ„Åò„Çã</button>
            </div>
        </div>
    </div>
    <!-- „Éá„ÉÉ„Ç≠‰ΩúÊàê „É¢„Éº„ÉÄ„É´ -->
    <div id="deck-modal" class="modal">
        <div id="deck-modal-content" class="modal-content">
            
            <!-- <span class="close" onclick="showDeckSaveModal()">&times;</span> -->
            <!-- „Ç´„Éº„Éâ„É™„Çπ„Éà„ÇÑ‰ΩúÊàêUI„Åå„Åì„Åì„Å´ÊåøÂÖ•„Åï„Çå„Åæ„Åô -->
            <div id="deck-builder" class="deck-builder-container">
                <!-- Â§ñÂÅ¥„Çø„ÉñÔºö1Ë°åÁõÆ -->
                <div id="deck-tabs" class="tab-group">
                    <button class="tab-button active" onclick="showDeckTab('pool')">„Ç´„Éº„Éâ„Ç≤„Éº„É†</button>
                    <button class="tab-button" onclick="showDeckTab('deck')">„Éá„ÉÉ„Ç≠Á∑®ÈõÜ</button>
                    <button id="open-filter-modal-button" class="tab-button" onclick="openFilterModal()">üîç</button>
                    <button id="deck-builder-button" class="tab-button" onclick="showDeckSaveModal()">‰øùÂ≠ò</button>
                </div>
                <!-- ÂÜÖÂÅ¥„Çø„ÉñÔºö2Ë°åÁõÆÔºà„Ç´„ÉÜ„Ç¥„É™Âàá„ÇäÊõø„ÅàÔºâ -->
                 <!-- <button id="deck-builder-button" class="tab-button" onclick="showDeckSaveModal()">‰øùÂ≠ò</button> -->
                <!-- „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„É™„Çπ„Éà -->
                <div class="deck-cost-display">
                    <p id="deck-counter">„Éá„ÉÉ„Ç≠ÊûöÊï∞: <span id="deck-cost-summary"></span></p>
                    <div id="deck-cost-bar" class="cost-bar-horizontal"></div>
                </div>
                
                <!-- ‰∏äÊÆµÔºöË©≥Á¥∞Ë°®Á§∫ -->
                <div id="deck-detail-panel">
                    <div id="deck-detail-name"></div>
                    <div id="deck-detail-ability"></div>
                </div>

                <!-- „Éá„ÉÉ„Ç≠ „Çø„Éñ-->
                <div id="deck-section" class="section">
                    <div id="deck-header" class="header">
                        <div id="deck-overview" class="deck-overview">
                            <!-- „Éá„ÉÉ„Ç≠„ÅÆ„Ç´„Éº„ÉâÂêç„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                    <div id="deck-pool-list" class="card-list">
                        <!-- „Éá„ÉÉ„Ç≠ÂÜÖ„ÅÆ„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                    </div>
                </div>
                <!-- „Ç´„Éº„Éâ„Éó„Éº„É´  „Çø„Éñ-->
                <div id="card-pool-section" class="section">
                    <div id="card-pool-list" class="card-list">
                        <!-- „Ç´„Éº„Éâ„Éó„Éº„É´„ÅÆ„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                    </div>
                </div>
            </div>
            
            
            
        </div>
    </div>
    
    <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="modal-overlay" class="hidden"></div>
</body>
<!-- üîΩ „Éï„Ç£„É´„Çø„Éº„É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
<div id="filter-modal" class="modal-backdrop" style="display: none;">
  <div class="modal-box">
    <h3>„Ç´„Éº„Éâ„Éï„Ç£„É´„Çø„Éº</h3>
    <div id="filter-controls">
      <div class="filter-row">
        <label for="filter-category-select">„Ç´„ÉÜ„Ç¥„É™:</label>
        <select id="filter-category-select" onchange="filterCardPool(this.value)">
          <option value="all">„Åô„Åπ„Å¶</option>
          <option value="„Ç≠„É£„É©">„Ç≠„É£„É©</option>
          <option value="ÊñΩË®≠">ÊñΩË®≠</option>
          <option value="„Çπ„Ç≠„É´">„Çπ„Ç≠„É´</option>
          <option value="„Éû„Ç∏„ÉÉ„ÇØ">„Éû„Ç∏„ÉÉ„ÇØ</option>
          <option value="„Ç§„Éô„É≥„Éà">„Ç§„Éô„É≥„Éà</option>
        </select>

        <label for="filter-cost">„Ç≥„Çπ„Éà:</label>
        <select id="filter-cost" onchange="applyFilters()">
          <option value="">„Åô„Åπ„Å¶</option>
          <option value="0">0</option><option value="1">1</option>
          <option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option>
          <option value="6">6</option><option value="7">7</option>
          <option value="8">8</option><option value="9">9</option>
          <option value="10">10</option>
        </select>

        <label for="filter-rarity">„É¨„Ç¢„É™„ÉÜ„Ç£:</label>
        <select id="filter-rarity" onchange="applyFilters()">
          <option value="">„Åô„Åπ„Å¶</option>
          <option value="B">B</option>
          <option value="S">S</option>
          <option value="G">G</option>
          <option value="P">P</option>
          <option value="EX">EX</option>
        </select>
      </div>

      <div class="filter-row">
        <label for="filter-race">Á®ÆÊóè:</label>
        <select id="filter-race" onchange="applyFilters()">
          <option value="">„Åô„Åπ„Å¶</option>
        </select>

        <label for="filter-class">„ÇØ„É©„Çπ:</label>
        <select id="filter-class" onchange="applyFilters()">
          <option value="">„Åô„Åπ„Å¶</option>
        </select>
      </div>
    </div>

    <div class="dialog-buttons">
      <button onclick="applyFilters(); closeFilterModal()">ÈÅ©Áî®</button>
      <button onclick="closeFilterModal()">„Ç≠„É£„É≥„Çª„É´</button>
    </div>
  </div>
</div>


<script>
function openFilterModal() {
  document.getElementById("filter-modal").style.display = "flex";
}

function closeFilterModal() {
  document.getElementById("filter-modal").style.display = "none";
}
</script>

</html>
<script src="js/dashboard.js"></script>
<script src="js/deck.js"></script>
<script src="js/p2p.js"></script>
<script src="js/battle.js"></script>
<script>
// ==== Ë¶ÅÁ¥†Á¶ÅÊ≠¢„Ç®„É™„Ç¢ =================================================================================

document.addEventListener("touchstart", (e) => {
    // „Çπ„ÉØ„Ç§„Éó„É™„É≠„Éº„ÉâÊ§úÂá∫„ÅÆ„Åü„ÇÅ„Å´ÈñãÂßãÊôÇ„ÅÆ‰ΩçÁΩÆ„ÇíË®òÈå≤
    window.startY = e.touches[0].clientY;
  }, { passive: false });
  
document.addEventListener("touchmove", (e) => {
    const currentY = e.touches[0].clientY;

    // „Éö„Éº„Ç∏„ÅÆ‰∏ÄÁï™‰∏ä„Åß„ÄÅ‰∏ãÊñπÂêë„Å∏„ÅÆ„Çπ„ÉØ„Ç§„ÉóÔºà„É™„É≠„Éº„ÉâÊìç‰ΩúÔºâ„ÇíÊ§úÂá∫„Åó„Å¶Èò≤Ê≠¢
    if (window.scrollY === 0 && currentY > window.startY) {
        // ÂÆüÈöõ„Å´‰∏ãÊñπÂêë„Å∏Âãï„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø„É™„É≠„Éº„Éâ„ÇíÈò≤Ê≠¢
        if (currentY - window.startY > 13) { // ÂøÖË¶Å„Å´Âøú„Åò„Å¶ÈñæÂÄ§„ÇíË™øÊï¥
        e.preventDefault(); // „Çπ„ÉØ„Ç§„Éó„É™„É≠„Éº„Éâ„ÇíÁÑ°ÂäπÂåñ
        }
    }
}, { passive: false });
  
//========================================================================

// ÂàùÊúüÂ±•Ê≠¥ËøΩÂä†
let canExit = false;

window.addEventListener('load', () => {
  console.log('[load] Â±•Ê≠¥Êï∞:', history.length);
  history.pushState({ preventBack: true }, '', '');
});

window.addEventListener('popstate', () => {
  console.log('[popstate] fired');
  console.log('Â±•Ê≠¥Êï∞:', history.length);
  console.log('location.href:', location.href);
  console.log('canExit:', canExit);
  console.log('document.activeElement:', document.activeElement);
  console.log('visibility:', document.visibilityState);

  if (!canExit) {
    const confirmBack = confirm('„Ç≤„Éº„É†„ÇíÁµÇ‰∫Ü„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü');
    if (confirmBack) {
      canExit = true;
      history.back();
    } else {
      history.pushState({ preventBack: true }, '', '');
    }
  }
});



</script>